5. Cambiar el estado del pedido
PATCH /api/orders/:id/statusPermiso: orders.updateBody: UpdateOrderStatusDto
Transiciones permitidas
	â€¢	DRAFT â†’ OPEN, HOLD, CANCELED
	â€¢	OPEN â†’ HOLD, CANCELED, CLOSED
	â€¢	HOLD â†’ OPEN, CANCELED
	â€¢	CLOSED o CANCELED â†’ no se mueven
{
  "status": "CLOSED"
}
{
    "error": null,
    "data": null,
    "message": "Updated"
}

Reglas extra
	â€¢	Al cerrar (CLOSED) se:
	0.	recalcular totales
	0.	validar que pagos + propinas >= total
	0.	si no cubre â†’ 409
	â€¢	Se actualizan automÃ¡ticamente los timestamps:
	â€¢	acceptedAt
	â€¢	readyAt
	â€¢	servedAt
	â€¢	closedAt
	â€¢	canceledAt
Casos :TODOS los casos que puedes mandar
1. Pasar de OPEN â†’ HOLD

{
  "status": "HOLD"
}
Ãštil cuando el mesero â€œlo estÃ¡ armandoâ€ pero no quiere que avance.

2. Volver de HOLD â†’ OPEN

{
  "status": "OPEN"
}
Para reactivarlo en listas y en KDS.

3. Marcar que la casa ya aceptÃ³ el pedido (p. ej. delivery)

{
  "status": "ACCEPTED"
}
El repo va a poner:

acceptedAt = now()

4. Marcar que ya estÃ¡ listo (cocina terminÃ³)

{
  "status": "READY"
}
El repo:

readyAt = now()
Esto hace que el KDS lo pueda mandar a columna â€œlistosâ€.

5. Marcar que ya se sirviÃ³ (para DINE_IN)

{
  "status": "SERVED"
}
El repo:

servedAt = now()

6. Cerrar pedido (CLOSED) ğŸ’°

{
  "status": "CLOSED"
}
ğŸ”´ AquÃ­ entra la regla que te pusieron en la instrucciÃ³n:
â€œno permite cerrar si paidTotal < totalâ€
O sea, el repo hace algo asÃ­:
	â€¢	suma payments.amountCents
	â€¢	compara con order.totalCents
	â€¢	si es menor â†’ responde error
Respuesta si NO estÃ¡ pagado:

{
  "error": {
    "code": 400,
    "details": "Order cannot be closed because it is not fully paid"
  },
  "data": null,
  "message": "Order not fully paid"
}
Respuesta si SÃ estÃ¡ pagado:

{
  "error": null,
  "data": {
    "id": 145,
    "status": "CLOSED",
    "closedAt": "2025-10-30T18:30:00.000Z",
    "payments": [
      { "id": 1, "amountCents": 23000 }
    ],
    "totalCents": 23000,
    "...": "..."
  },
  "message": "OK"
}

7. Cancelar pedido

{
  "status": "CANCELED",
  "reason": "El cliente se fue"
}
El repo:

canceledAt = now()
y guarda el motivo si lo mapeaste en el modelo.

8. Cancelar SIN motivo

{
  "status": "CANCELED"
}
VÃ¡lido porque el DTO lo pone como opcional.

9. â€œRevivirâ€ un pedido en HOLD que estaba con tiempo

{
  "status": "OPEN"
}
(igual que el caso 2, pero lo uso mucho en front)

10. Intentar cerrar un pedido que tiene 0 pagos â†’ debe fallar

{
  "status": "CLOSED"
}
Respuesta esperada:

{
  "error": {
    "code": 400,
    "details": "Order cannot be closed because it is not fully paid"
  },
  "data": null,
  "message": "Order not fully paid"
}
Esto es EXACTAMENTE lo que te pedÃ­an: â€œno permite cerrarâ€¦â€

11. Ponerlo ACCEPTED y de una READY (dos llamadas)
	0.	

{ "status": "ACCEPTED" }
	0.	

{ "status": "READY" }
Esto lo hacen algunas pantallas de cocina.

12. Pasar de READY â†’ SERVED â†’ CLOSED
	0.	

{ "status": "SERVED" }
	0.	(cuando ya pagÃ³)

{ "status": "CLOSED" }

13. Pedido de delivery que nunca llegÃ³ â†’ cancel

{
  "status": "CANCELED",
  "reason": "Rechazado por el repartidor"
}

14. Pedido de app que quieres reactivar â†’ OPEN

{
  "status": "OPEN"
}

15. Body vacÃ­o (no hace nada, pero lo pongo para pruebas)

{}
El Zod te va a decir algo como â€œstatus is requiredâ€, porque este sÃ­ es de los que SÃ requieren el campo.
Respuesta de validaciÃ³n:

{
  "error": {
    "code": 400,
    "details": "status is required"
  },
  "data": null,
  "message": "Validation failed"
}



10. Notas funcionales clave
	â€¢	Los totales siempre se recalculan ignorando Ã­tems cancelados.
	â€¢	Se respetan descuentos / impuestos / service fee ya guardados.
	â€¢	prepEtaMinutes sirve para mostrar ETA en front / kiosko.
	â€¢	source y externalRef diferencian interno vs plataforma.
	â€¢	Con esto el front puede hacer todo el flujo:
	0.	creaciÃ³n
	0.	agregar / editar Ã­tems
	0.	KDS
	0.	cobros
	0.	cierre
	0.	listado con filtros

11. Glosario para el front
Permisos
	â€¢	orders.read: puede listar y ver
	â€¢	orders.create: puede crear
	â€¢	orders.update: puede editar, pagar, mover estado
serviceType (tipo de servicio)
	â€¢	DINE_IN: consumo en mesa
	â€¢	TAKEAWAY: para llevar
	â€¢	DELIVERY: a domicilio
source (canal)
	â€¢	POS: pedido directo
	â€¢	UBER, DIDI, RAPPI: plataformas externas
status del pedido
	â€¢	DRAFT: borrador, no cocina
	â€¢	OPEN: activo
	â€¢	HOLD: en pausa
	â€¢	CLOSED: cobrado y cerrado
	â€¢	CANCELED: cancelado
OrderItem.status
	â€¢	NEW
	â€¢	IN_PROGRESS
	â€¢	READY
	â€¢	SERVED
	â€¢	CANCELED
Timestamps
	â€¢	acceptedAt: el pedido saliÃ³ de borrador / cocina lo tomÃ³
	â€¢	readyAt: todos los Ã­tems estÃ¡n listos
	â€¢	servedAt: todos servidos o cancelados
	â€¢	closedAt: se cobrÃ³
	â€¢	canceledAt: se cancelÃ³
Totales (centavos)
	â€¢	subtotalCents: suma de renglones
	â€¢	discountCents: descuentos
	â€¢	serviceFeeCents: propina/fee fijo
	â€¢	taxCents: impuestos
	â€¢	totalCents: subtotal - descuento + service + tax
	â€¢	paymentsTotalCents: suma de pagos
	â€¢	paymentsTipCents: suma de propinas
Pagos (payments[])
	â€¢	method: CASH | CARD | TRANSFER | OTHER
	â€¢	amountCents
	â€¢	tipCents
	â€¢	paidAt
	â€¢	note
Mesa
	â€¢	tableId: id de la mesa
	â€¢	table: { id, name } para mostrar â€œMesa 12â€
	â€¢	covers: nÃºmero de comensales
DTOs clave
	â€¢	ListOrdersQueryDto: filtros del GET
	â€¢	UpdateOrderMetaDto: para editar nota, mesa, cubiertos, ETA
	â€¢	UpdateOrderStatusDto: para mover el pedido validando pagos