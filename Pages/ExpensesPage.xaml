<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Imdeliceapp.Pages.ExpensesPage"
             Title="Gastos"
              Shell.NavBarIsVisible="True"
             BackgroundColor="{AppThemeBinding Light=White, Dark=Black}">
  <Grid RowDefinitions="Auto,*">
    <VerticalStackLayout Padding="24" Spacing="14">
     
      <Label Text="Registra compras urgentes, mermas y otros egresos."
             FontSize="13"
             TextColor="{AppThemeBinding Light=#696969, Dark=#BEBEBE}"/>

      <Grid ColumnDefinitions="*,*"
            ColumnSpacing="12">
        <VerticalStackLayout>
          <Label Text="Desde" FontSize="12" TextColor="{AppThemeBinding Light=#6F6F6F, Dark=#BFBFBF}"/>
          <DatePicker x:Name="FromDatePicker"
                      DateSelected="FromDatePicker_DateSelected"/>
        </VerticalStackLayout>
        <VerticalStackLayout Grid.Column="1">
          <Label Text="Hasta" FontSize="12" TextColor="{AppThemeBinding Light=#6F6F6F, Dark=#BFBFBF}"/>
          <DatePicker x:Name="ToDatePicker"
                      DateSelected="ToDatePicker_DateSelected"/>
        </VerticalStackLayout>
      </Grid>

      <SearchBar x:Name="SearchBar"
                 Placeholder="Buscar concepto o notas"
                 SearchButtonPressed="SearchBar_SearchButtonPressed"
                 TextChanged="SearchBar_TextChanged"/>

      <Border Padding="16"
              StrokeThickness="1"
              Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}"
              BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1F1F1F}"
              StrokeShape="{RoundRectangle CornerRadius=18}">
        <VerticalStackLayout Spacing="4">
          <Label x:Name="SummaryTotalLabel"
                 FontSize="20"
                 FontAttributes="Bold"
                 TextColor="{AppThemeBinding Light=Black, Dark=White}"
                 Text="$0.00"/>
          <Label x:Name="SummaryInfoLabel"
                 FontSize="12"
                 TextColor="{AppThemeBinding Light=#6E6E6E, Dark=#B5B5B5}"
                 Text="Sin informaciÃ³n"/>
        </VerticalStackLayout>
      </Border>
    </VerticalStackLayout>

    <RefreshView Grid.Row="1"
                 x:Name="ExpensesRefresh"
                 Refreshing="ExpensesRefresh_Refreshing">
      <CollectionView ItemsSource="{Binding Expenses}"
                      SelectionMode="None"
                      Margin="24,0">
        <CollectionView.EmptyView>
          <Label Text="No hay gastos en el periodo seleccionado."
                 Margin="40"
                 HorizontalTextAlignment="Center"
                 TextColor="{AppThemeBinding Light=#777, Dark=#AAA}"/>
        </CollectionView.EmptyView>
        <CollectionView.ItemTemplate>
          <DataTemplate>
            <Border Margin="0,10"
                    Padding="18"
                    StrokeThickness="0"
                    BackgroundColor="{AppThemeBinding Light=#F8F4FF, Dark=#2A233F}"
                    StrokeShape="{RoundRectangle CornerRadius=18}">
              <VerticalStackLayout Spacing="8">
                <Grid ColumnDefinitions="*,Auto">
                  <Label Text="{Binding Concept}"
                         FontAttributes="Bold"
                         FontSize="15"
                         TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                  <Border Grid.Column="1"
                          BackgroundColor="{AppThemeBinding Light=#F1D9FF, Dark=#4A2C54}"
                          Padding="6,2"
                          StrokeThickness="0"
                          StrokeShape="{RoundRectangle CornerRadius=10}">
                    <Label Text="{Binding AmountDisplay}"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#5B1E4B, Dark=#FFE4FF}"/>
                  </Border>
                </Grid>
                <Label Text="{Binding CategoryLabel}"
                       FontSize="12"
                       TextColor="{AppThemeBinding Light=#5A5A5A, Dark=#CACACA}"/>
                <Label Text="{Binding DateLabel}"
                       FontSize="12"
                       TextColor="{AppThemeBinding Light=#7A7A7A, Dark=#BBBBBB}"/>
                <Label Text="{Binding Notes}"
                       FontSize="12"
                       TextColor="{AppThemeBinding Light=#969696, Dark=#D5D5D5}"
                       IsVisible="{Binding HasNotes}"/>
                <Label Text="{Binding PaymentLabel}"
                       FontSize="12"
                       TextColor="{AppThemeBinding Light=#969696, Dark=#D5D5D5}"
                       IsVisible="{Binding HasPayment}"/>
              </VerticalStackLayout>
            </Border>
          </DataTemplate>
        </CollectionView.ItemTemplate>
      </CollectionView>
    </RefreshView>

    <Button Grid.Row="1"
            x:Name="AddButton"
            Text="+"
            WidthRequest="56"
            HeightRequest="56"
            CornerRadius="28"
            BackgroundColor="{StaticResource BrandPrimary}"
            TextColor="{StaticResource BrandOnPrimary}"
            HorizontalOptions="End"
            VerticalOptions="End"
            Margin="0,0,24,24"
            Clicked="AddButton_Clicked"/>
  </Grid>
</ContentPage>
