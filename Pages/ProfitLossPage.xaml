<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Imdeliceapp.Pages.ProfitLossPage"
             Title="Ganancias vs Gastos"
              Shell.NavBarIsVisible="True"
             BackgroundColor="{AppThemeBinding Light=White, Dark=Black}">
  <Grid RowDefinitions="Auto,*">
    <VerticalStackLayout Padding="24" Spacing="14">
      
      <Label Text="Compara ingresos registrados con los gastos capturados."
             FontSize="13"
             TextColor="{AppThemeBinding Light=#696969, Dark=#BEBEBE}"/>

      <Grid ColumnDefinitions="*,*"
            ColumnSpacing="12">
        <VerticalStackLayout>
          <Label Text="Desde" FontSize="12" TextColor="{AppThemeBinding Light=#6F6F6F, Dark=#BFBFBF}"/>
          <DatePicker x:Name="FromDatePicker"
                      DateSelected="FromDatePicker_DateSelected"/>
        </VerticalStackLayout>
        <VerticalStackLayout Grid.Column="1">
          <Label Text="Hasta" FontSize="12" TextColor="{AppThemeBinding Light=#6F6F6F, Dark=#BFBFBF}"/>
          <DatePicker x:Name="ToDatePicker"
                      DateSelected="ToDatePicker_DateSelected"/>
        </VerticalStackLayout>
      </Grid>

      <Button Text="Actualizar"
              Clicked="RefreshButton_Clicked"
              Style="{StaticResource PrimaryButtonStyle}"/>
    </VerticalStackLayout>

    <RefreshView Grid.Row="1"
                 x:Name="ReportRefresh"
                 Refreshing="ReportRefresh_Refreshing">
      <ScrollView>
        <VerticalStackLayout Padding="24" Spacing="18">
          <Border Padding="16"
                  BackgroundColor="{AppThemeBinding Light=#EEF8F0, Dark=#1F2A24}"
                  StrokeThickness="0"
                  StrokeShape="{RoundRectangle CornerRadius=18}">
            <VerticalStackLayout>
              <Label Text="Ingresos"
                     FontAttributes="Bold"
                     FontSize="16"
                     TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
              <Label x:Name="IncomeLabel"
                     FontSize="28"
                     FontAttributes="Bold"
                     Text="$0.00"
                     TextColor="{AppThemeBinding Light=#1B5E20, Dark=#8BC34A}"/>
            </VerticalStackLayout>
          </Border>

          <Border Padding="16"
                  BackgroundColor="{AppThemeBinding Light=#FFF2F2, Dark=#2D1F1F}"
                  StrokeThickness="0"
                  StrokeShape="{RoundRectangle CornerRadius=18}">
            <VerticalStackLayout>
              <Label Text="Gastos"
                     FontAttributes="Bold"
                     FontSize="16"
                     TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
              <Label x:Name="ExpensesLabel"
                     FontSize="28"
                     FontAttributes="Bold"
                     Text="$0.00"
                     TextColor="{AppThemeBinding Light=#B71C1C, Dark=#FF8A80}"/>
            </VerticalStackLayout>
          </Border>

          <Border Padding="16"
                  BackgroundColor="{AppThemeBinding Light=#F5F2FF, Dark=#241E32}"
                  StrokeThickness="0"
                  StrokeShape="{RoundRectangle CornerRadius=18}">
            <VerticalStackLayout>
              <Label Text="Resultado neto"
                     FontAttributes="Bold"
                     FontSize="16"
                     TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
              <Label x:Name="NetLabel"
                     FontSize="30"
                     FontAttributes="Bold"
                     Text="$0.00"/>
              <Label x:Name="NetInfoLabel"
                     FontSize="12"
                     TextColor="{AppThemeBinding Light=#6F6F6F, Dark=#C0C0C0}"
                     Text="Ingresos - Gastos"/>
            </VerticalStackLayout>
          </Border>

          <Label x:Name="IncomeSummaryLabel"
                 FontSize="13"
                 TextColor="{AppThemeBinding Light=#444, Dark=#CCCCCC}"/>
          <Label x:Name="ExpenseSummaryLabel"
                 FontSize="13"
                 TextColor="{AppThemeBinding Light=#444, Dark=#CCCCCC}"/>

          <Label Text="Órdenes (detalle)"
                 FontAttributes="Bold"
                 FontSize="15"
                 TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
          <Label x:Name="OrdersEmptyLabel"
                 FontSize="13"
                 TextColor="{AppThemeBinding Light=#666, Dark=#BBBBBB}"
                 IsVisible="False"
                 Text="Sin órdenes en el periodo."/>
          <CollectionView x:Name="OrdersCollection"
                          SelectionMode="None"
                          ItemsLayout="VerticalList"
                          Margin="0,0,0,12"
                          IsVisible="False">
            <CollectionView.ItemTemplate>
              <DataTemplate>
                <Border Margin="0,6"
                        Padding="12"
                        StrokeThickness="0"
                        BackgroundColor="{AppThemeBinding Light=#EFF7FF, Dark=#203040}"
                        StrokeShape="{RoundRectangle CornerRadius=14}">
                  <VerticalStackLayout Spacing="4">
                    <Label Text="{Binding Title}"
                           FontAttributes="Bold"
                           FontSize="14"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                    <Label Text="{Binding SubTitle}"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light=#555, Dark=#C5C5C5}"/>
                    <Grid ColumnDefinitions="*,Auto">
                      <Label Text="{Binding Meta}"
                             FontSize="12"
                             TextColor="{AppThemeBinding Light=#777, Dark=#BEBEBE}"/>
                      <Label Grid.Column="1"
                             Text="{Binding TotalDisplay}"
                             FontAttributes="Bold"
                             TextColor="{AppThemeBinding Light=#1B5E20, Dark=#9CCC65}"/>
                    </Grid>
                  </VerticalStackLayout>
                </Border>
              </DataTemplate>
            </CollectionView.ItemTemplate>
          </CollectionView>

          <Label Text="Gastos (detalle)"
                 FontAttributes="Bold"
                 FontSize="15"
                 TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
          <CollectionView x:Name="ExpensesDetailCollection"
                          SelectionMode="None"
                          ItemsLayout="VerticalList"
                          Margin="0,0,0,12">
            <CollectionView.ItemTemplate>
              <DataTemplate>
                <Border Margin="0,6"
                        Padding="12"
                        StrokeThickness="0"
                        BackgroundColor="{AppThemeBinding Light=#FDF2FF, Dark=#2E2133}"
                        StrokeShape="{RoundRectangle CornerRadius=14}">
                  <VerticalStackLayout Spacing="4">
                    <Label Text="{Binding Concept}"
                           FontAttributes="Bold"
                           FontSize="14"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                    <Label Text="{Binding CategoryLabel}"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light=#555, Dark=#C5C5C5}"/>
                    <Grid ColumnDefinitions="*,Auto">
                      <Label Text="{Binding DateLabel}"
                             FontSize="12"
                             TextColor="{AppThemeBinding Light=#777, Dark=#BEBEBE}"/>
                      <Label Grid.Column="1"
                             Text="{Binding AmountDisplay}"
                             FontAttributes="Bold"
                             TextColor="{AppThemeBinding Light=#7B1FA2, Dark=#E1BEE7}"/>
                    </Grid>
                    <Label Text="{Binding Notes}"
                           FontSize="12"
                           TextColor="{AppThemeBinding Light=#888, Dark=#BBBBBB}"
                           IsVisible="{Binding HasNotes}"/>
                  </VerticalStackLayout>
                </Border>
              </DataTemplate>
            </CollectionView.ItemTemplate>
          </CollectionView>

          <Label Text="Ingresos por método"
                 FontAttributes="Bold"
                 FontSize="15"
                 TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
          <CollectionView x:Name="PaymentsCollection"
                          SelectionMode="None"
                          ItemsLayout="VerticalList"
                          Margin="0,0,0,12">
            <CollectionView.ItemTemplate>
              <DataTemplate>
                <Border Margin="0,6"
                        Padding="12"
                        StrokeThickness="0"
                        BackgroundColor="{AppThemeBinding Light=#F1F0FF, Dark=#2B2640}"
                        StrokeShape="{RoundRectangle CornerRadius=14}">
                  <Grid ColumnDefinitions="*,Auto">
                    <Label Text="{Binding Method}"
                           FontAttributes="Bold"
                           FontSize="14"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                    <Label Grid.Column="1"
                           Text="{Binding AmountDisplay}"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light=#4E2B71, Dark=#D1B2FF}"/>
                  </Grid>
                </Border>
              </DataTemplate>
            </CollectionView.ItemTemplate>
          </CollectionView>

          <Label Text="Gastos por categoría"
                 FontAttributes="Bold"
                 FontSize="15"
                 TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
          <CollectionView x:Name="ExpensesCollection"
                          SelectionMode="None"
                          ItemsLayout="VerticalList">
            <CollectionView.ItemTemplate>
              <DataTemplate>
                <Border Margin="0,6"
                        Padding="12"
                        StrokeThickness="0"
                        BackgroundColor="{AppThemeBinding Light=#FEF4FB, Dark=#302030}"
                        StrokeShape="{RoundRectangle CornerRadius=14}">
                  <Grid ColumnDefinitions="*,Auto">
                    <Label Text="{Binding Category}"
                           FontAttributes="Bold"
                           FontSize="14"
                           TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                    <Label Grid.Column="1"
                           Text="{Binding AmountDisplay}"
                           FontAttributes="Bold"
                          TextColor="{AppThemeBinding Light=#7B1FA2, Dark=#E1BEE7}"/>
                  </Grid>
                </Border>
              </DataTemplate>
            </CollectionView.ItemTemplate>
          </CollectionView>
        </VerticalStackLayout>
      </ScrollView>
    </RefreshView>
  </Grid>
</ContentPage>
