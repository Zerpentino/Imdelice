<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="Imdeliceapp.Pages.ProductModifiersPage"
    Title="Disponibilidad de opciones"
    BackgroundColor="{AppThemeBinding Light=White, Dark=Black}"
    Shell.NavBarIsVisible="True"
    Shell.BackgroundColor="{StaticResource BrandPrimary}"
    Shell.ForegroundColor="{StaticResource BrandOnPrimary}"
    Shell.TitleColor="{StaticResource BrandOnPrimary}">

  <ContentPage.ToolbarItems>
    <ToolbarItem Text="Reglas por variante"
                 Order="Secondary"
                 Priority="0"
                 Clicked="VariantOverrides_Clicked" />
  </ContentPage.ToolbarItems>

  <Grid Padding="12">
    <CollectionView x:Name="GroupsCV"
                    ItemsSource="{Binding Groups}"
                    Margin="0,0,0,8">
      <CollectionView.EmptyView>
        <VerticalStackLayout Padding="24" Spacing="6"
                             HorizontalOptions="Center" VerticalOptions="Center">
          <Label Text="Este producto no tiene grupos vinculados."
                 TextColor="{AppThemeBinding Light=#666, Dark=#AAA}"/>
          <Label Text="(Asegúrate de tener grupos y opciones vinculadas al producto.)"
                 FontSize="12"
                 TextColor="{AppThemeBinding Light=#999, Dark=#777}"/>
        </VerticalStackLayout>
      </CollectionView.EmptyView>

      <CollectionView.ItemTemplate>
        <DataTemplate>
          <Frame Margin="0,8" Padding="12" HasShadow="False"
                 BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}">
            <VerticalStackLayout Spacing="6">
              <Label Text="{Binding GroupName}"
                     FontAttributes="Bold"
                     TextColor="{AppThemeBinding Light=Black, Dark=White}"/>

              <!-- Lista de opciones del grupo con switch de disponibilidad -->
              <CollectionView ItemsSource="{Binding Options}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                  <DataTemplate>
                    <Grid ColumnDefinitions="*,Auto" Padding="6">
                      <VerticalStackLayout Spacing="2">
                        <Label Text="{Binding Name}"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                        <!-- etiqueta de precio extra, si aplica -->
                        <Label Text="{Binding ExtraLabel}"
                               FontSize="11"
                               TextColor="{AppThemeBinding Light=#666, Dark=#CCC}">
                          <Label.Triggers>
                            <DataTrigger TargetType="Label" Binding="{Binding HasExtra}" Value="False">
                              <Setter Property="IsVisible" Value="False"/>
                            </DataTrigger>
                          </Label.Triggers>
                        </Label>

                        <!-- chip “No disponible” -->
                        <!-- chip “No disponible” -->
<Border StrokeThickness="0" BackgroundColor="#FAD7D7" Padding="6,2"
        StrokeShape="{RoundRectangle CornerRadius=8}">
  <Border.Triggers>
    <DataTrigger TargetType="Border" Binding="{Binding IsActive}" Value="True">
      <Setter Property="IsVisible" Value="False"/>
    </DataTrigger>
  </Border.Triggers>
  <Label Text="No disponible" FontSize="11" TextColor="#B71C1C"/>
</Border>

<Switch Grid.Column="1"
        HorizontalOptions="End" VerticalOptions="Center"
        IsToggled="{Binding IsActive, Mode=TwoWay}"
        Toggled="OptionToggle_Toggled"/>

                      </VerticalStackLayout>

                      <!-- <Switch Grid.Column="1"
                              HorizontalOptions="End" VerticalOptions="Center"
                              IsToggled="{Binding IsAvailable, Mode=TwoWay}"
                              Toggled="OptionToggle_Toggled"/> -->
                    </Grid>
                  </DataTemplate>
                </CollectionView.ItemTemplate>
              </CollectionView>
            </VerticalStackLayout>
          </Frame>
        </DataTemplate>
      </CollectionView.ItemTemplate>
    </CollectionView>
  </Grid>
</ContentPage>
