
Contrato del m√≥dulo de pedidos (API)
0. Notas generales
	‚Ä¢	Todas las respuestas usan wrapper est√°ndar:{ error, data, message }
	‚Ä¢	Todas las rutas est√°n protegidas con permisos:
	‚Ä¢	orders.read
	‚Ä¢	orders.create
	‚Ä¢	orders.update
	‚Ä¢	El controlador usa AuthRequest, asyncHandler y no usa console.log.
	‚Ä¢	Siempre que se toca un pedido se recalculan totales ignorando √≠tems cancelados.

4. Actualizar metadatos del pedido
PATCH /api/orders/:id/metaPermiso: orders.updateBody: UpdateOrderMetaDto
Permite actualizar parcialmente:
	‚Ä¢	tableId
	‚Ä¢	note
	‚Ä¢	covers
	‚Ä¢	prepEtaMinutes
Para limpiar un campo: mandar null (mesa, cubiertos o ETA).
Ejemplo{
  "tableId": 1,
  "covers": 4,
  "note": "Mesa movida",
  "prepEtaMinutes": 8
}
Ejemplos;
Casos posibles (todos los que tiene sentido mandar)
1. Cambiar de mesa

{
  "tableId": 7
}
üëâ Pasa de la mesa que ten√≠a a la mesa 7.

2. Quitar la mesa (dejarlo sin mesa)

{
  "tableId": null
}
üëâ Esto est√° permitido porque el Zod lo puso como nullable. El repo lo guarda como null.

3. Poner / cambiar la nota

{
  "note": "Cumplea√±os, traer pastel"
}

4. Limpiar la nota

{
  "note": null
}
üëâ Queda sin nota.

5. Actualizar n√∫mero de comensales (covers)

{
  "covers": 4
}

6. Quitar los comensales (dejarlo sin valor)

{
  "covers": null
}

7. Poner tiempo estimado de preparaci√≥n (para KDS / delivery)

{
  "prepEtaMinutes": 20
}

8. Quitar el tiempo estimado

{
  "prepEtaMinutes": null
}

9. Cambiar mesa y nota al mismo tiempo

{
  "tableId": 4,
  "note": "Pasar primero las bebidas"
}

10. Mesa + covers

{
  "tableId": 2,
  "covers": 3
}

11. Todo junto (caso ‚Äúeditar encabezado‚Äù en el front)

{
  "tableId": 5,
  "note": "Cliente frecuente",
  "covers": 2,
  "prepEtaMinutes": 15
}

12. Body vac√≠o (el backend lo acepta, pero no cambia nada)

{}
üëâ El repo ve que no hay campos y sale sin actualizar. √ötil para probar que no truena.

13. Quitar varias cosas a la vez
(por ejemplo: lo pasaste a delivery y ya no quieres mesa ni covers ni nota)

{
  "tableId": null,
  "covers": null,
  "note": null
}

Respuesta: 200 con data: null.
{
    "error": null,
    "data": null,
    "message": "Updated"
}

10. Notas funcionales clave
	‚Ä¢	Los totales siempre se recalculan ignorando √≠tems cancelados.
	‚Ä¢	Se respetan descuentos / impuestos / service fee ya guardados.
	‚Ä¢	prepEtaMinutes sirve para mostrar ETA en front / kiosko.
	‚Ä¢	source y externalRef diferencian interno vs plataforma.
	‚Ä¢	Con esto el front puede hacer todo el flujo:
	0.	creaci√≥n
	0.	agregar / editar √≠tems
	0.	KDS
	0.	cobros
	0.	cierre
	0.	listado con filtros

11. Glosario para el front
Permisos
	‚Ä¢	orders.read: puede listar y ver
	‚Ä¢	orders.create: puede crear
	‚Ä¢	orders.update: puede editar, pagar, mover estado
serviceType (tipo de servicio)
	‚Ä¢	DINE_IN: consumo en mesa
	‚Ä¢	TAKEAWAY: para llevar
	‚Ä¢	DELIVERY: a domicilio
source (canal)
	‚Ä¢	POS: pedido directo
	‚Ä¢	UBER, DIDI, RAPPI: plataformas externas
status del pedido
	‚Ä¢	DRAFT: borrador, no cocina
	‚Ä¢	OPEN: activo
	‚Ä¢	HOLD: en pausa
	‚Ä¢	CLOSED: cobrado y cerrado
	‚Ä¢	CANCELED: cancelado
OrderItem.status
	‚Ä¢	NEW
	‚Ä¢	IN_PROGRESS
	‚Ä¢	READY
	‚Ä¢	SERVED
	‚Ä¢	CANCELED
Timestamps
	‚Ä¢	acceptedAt: el pedido sali√≥ de borrador / cocina lo tom√≥
	‚Ä¢	readyAt: todos los √≠tems est√°n listos
	‚Ä¢	servedAt: todos servidos o cancelados
	‚Ä¢	closedAt: se cobr√≥
	‚Ä¢	canceledAt: se cancel√≥
Totales (centavos)
	‚Ä¢	subtotalCents: suma de renglones
	‚Ä¢	discountCents: descuentos
	‚Ä¢	serviceFeeCents: propina/fee fijo
	‚Ä¢	taxCents: impuestos
	‚Ä¢	totalCents: subtotal - descuento + service + tax
	‚Ä¢	paymentsTotalCents: suma de pagos
	‚Ä¢	paymentsTipCents: suma de propinas
Pagos (payments[])
	‚Ä¢	method: CASH | CARD | TRANSFER | OTHER
	‚Ä¢	amountCents
	‚Ä¢	tipCents
	‚Ä¢	paidAt
	‚Ä¢	note
Mesa
	‚Ä¢	tableId: id de la mesa
	‚Ä¢	table: { id, name } para mostrar ‚ÄúMesa 12‚Äù
	‚Ä¢	covers: n√∫mero de comensales
DTOs clave
	‚Ä¢	ListOrdersQueryDto: filtros del GET
	‚Ä¢	UpdateOrderMetaDto: para editar nota, mesa, cubiertos, ETA
	‚Ä¢	UpdateOrderStatusDto: para mover el pedido validando pagos
